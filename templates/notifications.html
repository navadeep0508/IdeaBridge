{% extends "base.html" %}

{% block content %}
<div class="row">
  <div class="col-lg-8 mx-auto">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1" style="color: #0D2B1D; font-weight: 700;">
          <i class='bx bx-bell me-2'></i>Notifications
        </h2>
        <p class="text-muted mb-0">Stay updated with your latest activity</p>
      </div>
      {% if notifications %}
      <form method="POST" action="{{ url_for('mark_all_notifications_read_route') }}" style="display: inline;">
        <button type="submit" class="btn" style="background: #E3EFD3; color: #345635; border: none; border-radius: 50px; padding: 8px 20px; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#AEC3B0'" onmouseout="this.style.background='#E3EFD3'">
          <i class='bx bx-check-double me-1'></i>Mark All Read
        </button>
      </form>
      {% endif %}
    </div>

    {% if not notifications %}
    <div class="text-center py-5">
      <div style="width: 80px; height: 80px; border-radius: 50%; background: #E3EFD3; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
        <i class='bx bx-bell' style="font-size: 2.5rem; color: #345635;"></i>
      </div>
      <h4 style="color: #0D2B1D; font-weight: 600;">No notifications yet</h4>
      <p class="text-muted">When someone interacts with your content, you'll see it here.</p>
    </div>
    {% else %}
    <div class="card" style="border: none; box-shadow: 0 4px 20px rgba(13, 43, 29, 0.08); border-radius: 16px; overflow: hidden;">
      <div class="card-body p-0">
        {% for notification in notifications %}
        <div class="d-flex align-items-start p-4 {{ 'border-bottom' if not loop.last else '' }} {{ 'opacity-50' if notification.is_read else '' }}" style="border-color: #E3EFD3; transition: all 0.3s ease;" onmouseover="this.style.background='#E3EFD3'" onmouseout="this.style.background='transparent'">
          <!-- Notification Icon -->
          <div style="width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px; flex-shrink: 0;
            {% if notification.type == 'like' %}background: linear-gradient(135deg, #FF6B6B, #FF8E8E);{% elif notification.type == 'comment' %}background: linear-gradient(135deg, #4ECDC4, #44A08D);{% elif notification.type == 'message' %}background: linear-gradient(135deg, #45B7D1, #96C93D);{% else %}background: linear-gradient(135deg, #345635, #6B8F71);{% endif %}">
            {% if notification.type == 'like' %}
              <i class='bx bx-heart' style="font-size: 1.5rem; color: white;"></i>
            {% elif notification.type == 'comment' %}
              <i class='bx bx-comment-detail' style="font-size: 1.5rem; color: white;"></i>
            {% elif notification.type == 'message' %}
              <i class='bx bx-envelope' style="font-size: 1.5rem; color: white;"></i>
            {% else %}
              <i class='bx bx-info-circle' style="font-size: 1.5rem; color: white;"></i>
            {% endif %}
          </div>

          <!-- Notification Content -->
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1" style="color: #0D2B1D; font-weight: 600; font-size: 1rem;">
                  {{ notification.title }}
                  {% if not notification.is_read %}
                  <span class="badge" style="background: #dc3545; font-size: 0.6rem; margin-left: 8px;">New</span>
                  {% endif %}
                </h6>
                <p class="mb-2 text-muted" style="font-size: 0.9rem; line-height: 1.4;">{{ notification.message }}</p>
                <small class="text-muted">
                  <i class='bx bx-time-five me-1'></i>
                  {{ notification.created_at[:19].replace('T', ' ') }}
                </small>
              </div>

              <!-- Actions -->
              <div class="dropdown">
                <button class="btn p-1" type="button" data-bs-toggle="dropdown" style="color: #6c757d; border: none; background: transparent;">
                  <i class='bx bx-dots-vertical-rounded' style="font-size: 1.2rem;"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" style="border-radius: 8px; border: none; box-shadow: 0 4px 12px rgba(13, 43, 29, 0.15);">
                  {% if not notification.is_read %}
                  <li>
                    <form method="POST" action="{{ url_for('mark_notification_read_route', notification_id=notification.id) }}" style="display: inline;">
                      <button type="submit" class="dropdown-item" style="border-radius: 6px; padding: 8px 16px; font-size: 0.9rem;">
                        <i class='bx bx-check me-2'></i>Mark as Read
                      </button>
                    </form>
                  </li>
                  {% endif %}
                  <li>
                    <form method="POST" action="{{ url_for('delete_notification_route', notification_id=notification.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this notification?')">
                      <button type="submit" class="dropdown-item text-danger" style="border-radius: 6px; padding: 8px 16px; font-size: 0.9rem;">
                        <i class='bx bx-trash me-2'></i>Delete
                      </button>
                    </form>
                  </li>
                </ul>
              </div>
            </div>

            <!-- Related Link -->
            {% if notification.related_id and notification.related_type %}
            <div class="mt-2">
              {% if notification.related_type == 'pitch' %}
              <a href="{{ url_for('pitch', pitch_id=notification.related_id) }}" class="btn btn-sm" style="background: transparent; color: #345635; border: 1px solid #AEC3B0; border-radius: 20px; font-size: 0.8rem; padding: 4px 12px; transition: all 0.3s ease;" onmouseover="this.style.background='#345635'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='#345635'">
                <i class='bx bx-show me-1'></i>View Pitch
              </a>
              {% elif notification.related_type == 'user' %}
              <a href="{{ url_for('send_message', user_id=notification.related_id) }}" class="btn btn-sm" style="background: transparent; color: #345635; border: 1px solid #AEC3B0; border-radius: 20px; font-size: 0.8rem; padding: 4px 12px; transition: all 0.3s ease;" onmouseover="this.style.background='#345635'; this.style.color='white'" onmouseout="this.style.background='transparent'; this.style.color='#345635'">
                <i class='bx bx-reply me-1'></i>Reply
              </a>
              {% endif %}
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}
